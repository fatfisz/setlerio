<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%)}</style><body><script>"use strict";let t=0;const e=new Map;function n(...n){return t+=1,e.set(t,n),t}function o(t){e.delete(t)}function r(t,e,n=!1){const o=document.createElement("canvas");o.width=t,o.height=e;const r=o.getContext("2d");return r.imageSmoothingEnabled=n,[o,r]}class s{constructor(t,e){this.x=t,this.y=e}add({x:t,y:e}){return new s(this.x+t,this.y+e)}mul(t){return new s(this.x*t,this.y*t)}sub({x:t,y:e}){return new s(this.x-t,this.y-e)}toHex(){return new s(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new s(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new s(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance({x:t,y:e}){return((this.x-t)**2+(this.y-e)**2)**.5}toArray(){return[this.x,this.y]}toHash(){return`${this.x},${this.y}`}}function a(t){const e=t.indexOf(",");return new s(Number(t.slice(0,e)),Number(t.slice(e+1)))}const i=[new s(-40,-60),new s(40,-60),new s(80,0),new s(40,60),new s(-40,60),new s(-80,0)];function c(t,e,n=0){return 0===e?[t]:[...u(e).map((n,o,r)=>new s(t.x+n,t.y+r[(o+2*e)%r.length])),...e>n?c(t,e-1,n):[]]}function u(t){return[...f(t),...f(t).map(t=>-t)]}function f(t){return 0===t?[]:[-t,1-t,...f(t-1).map(t=>t+1),t]}const l=c(new s(0,0),1);function h({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return o<=60&&(n<=40||80-n>=o*(80/120))}function d(t,e,[n,o,r]){t[e]=n,t[e+1]=o,t[e+2]=r,t[e+3]=255}const m=new Map;function w(t,e){const n=String(t);return m.has(n)||m.set(n,e()),m.get(n)}const v={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144,">":267537,"âˆž":1074091328};function x(t,e,n,o,s,a=0,i=0,c=3){const u=w([e,n,c],()=>{const t=function(t,e){return w(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(g)),9*e.length-3]}(t),[s,a]=r(n,o),i=a.createImageData(n,o);let c=0,u=0;for(const n of t)"\n"===n?(c+=9,u=0):(y(i,e,u,c,n),u+=1+p(v[n]));return a.putImageData(i,0,0),s})}(e,n),[o,s]=r(t.width*c,t.height*c);return s.drawImage(t,0,0,t.width*c,t.height*c),o});t.drawImage(u,o-u.width*a,s-u.height*i)}function y(t,e,n,o,r){const s=v[r],a=p(s);for(let r=0;r<6*a;r+=1)if(s&1<<r){const s=n+r%a,i=o+Math.floor(r/a);d(t.data,4*(i*t.width+s),e)}}function g(t){return[...t].reduce((t,e)=>t+p(v[e]),1*Math.max(t.length-1,0))}function p(t){return(t.toString(2).length-1)/6}let b=!1,H={left:0,top:0,height:0},M=-1,S=[],k=new s(0,0);function A(){b=!1,o(M)}function C(t,e=k){A(),b=!0,M=n(4,E);const o=48*t.length,r=32+o;H={left:16+Math.max(0,Math.min(712,e.x-144)),top:e.y+16-(e.y>728?r:0),height:o},S=t,k=e}function E(t){W(()=>{t.fillStyle="white",t.fillRect(H.left,H.top,256,H.height);for(const[e,[n,o]]of S.entries())x(t,n,[0,0,0],H.left+16,H.top+48*(e+.5),0,.5),Array.isArray(o)&&x(t,">",[0,0,0],H.left+256-16,H.top+48*(e+.5),1,.5)})}function L({x:t,y:e},n){return t>=H.left&&t<H.left+256&&e>=H.top+48*n&&e<H.top+48*(n+1)}const[q,D]=r(1e3,1e3,!0);q.style.background="#D6EAF8";let j,T,$,F=new s(0,0),P=1,R=!1,I=!1;const O=new s(500,500);function z({clientX:t,clientY:e}){const{left:n,top:o,width:r,height:a}=q.getBoundingClientRect();return new s(1e3/r*(t-n),1e3/a*(e-o))}function B(t){const e=t.sub(O).mul(1/P).add(F),n={relative:t,canvas:e,hex:new s(0,0)},o=e.toHex().round().toCanvas();for(const t of l){const r=o.add(t.toCanvas());h(e.sub(r))&&(n.hex=r.toHex())}return n}function J(t,e){return t.sub(O).mul(1/P).sub(e).mul(-1)}function N(t,e){const{x:n,y:o}=t.sub(e).toCanvas();return Math.abs(n)<=1160&&Math.abs(o)<=1120}function W(t){D.save(),D.resetTransform(),t(),D.restore()}let Y=0;function X(t){return Math.round(.06*t)}class G{constructor({when:t=0,duration:e=0,run:n}){this.frame=Y+1+X(t),this.totalFrames=X(e),this.run=n}}const K=[];function Q(t){K.push(new G(t))}const U={food:100,wood:100,stone:100,iron:100,gold:100},V=new Set,Z=new Set;let _=!1;function tt(t){_?Z.add(t):(V.add(t),_=!0,Q({run:et(t),duration:200}),Q({run:nt(t),when:5200,duration:200}))}function et(t){return(e,n)=>{if(t.offset=e/n-1,t.opacity=e/n,e===n&&(_=!1,Z.size>0)){const[t]=Z;Z.delete(t),tt(t)}}}function nt(t){return(e,n)=>{t.offset=e/n/3,t.opacity=1-e/n,e===n&&V.delete(t)}}const ot={blank:{name:""},townCenter:{name:"town center",indestructible:!0},lumberjackHut:{name:"lumberjack's hut",requirements:[[["wood",2],["stone",2]],5e3],production:[[["wood",1]],5e3]},tower:{name:"tower",requirements:[[["wood",2],["stone",3]],5e3]}},rt=new Map,st=new Set,at=new Set;function it(t,e){ft(t,e,!0),ut(e)&&lt(t)}function ct(t){t.toHash();const{name:e}=rt.get(t.toHash());ot[e].name,ft(t,"blank",!0),ut(e)&&lt(t)}function ut(t){return"townCenter"===t||"tower"===t}function ft(t,e,r){const s=t.toHash();if(rt.has(s)){if(!r)return;o(rt.get(s).drawableHandle)}rt.set(s,{name:e,hex:t,drawableHandle:n(1,dt({name:ot[e].name,hex:t}),t)})}function lt(t){const e=new Set,n=new Set;if("blank"!==rt.get(t.toHash()).name){for(const e of c(t,4)){const t=rt.get(e.toHash());if(t&&ut(t.name))for(const e of c(t.hex,1))n.add(e.toHash())}for(const e of c(t,2))ft(e,"blank",!1);for(const e of c(t,2,2)){const t=e.toHash();n.has(t)||at.add(t)}for(const e of c(t,1)){const t=e.toHash();at.delete(t)}}else{for(const o of c(t,4)){const t=rt.get(o.toHash());if(t&&ut(t.name)){for(const n of c(t.hex,2,2))e.add(n.toHash());for(const e of c(t.hex,1))n.add(e.toHash())}}for(const t of n)e.delete(t);for(const r of c(t,2)){const t=r.toHash();e.has(t)?at.add(t):n.has(t)||(o(rt.get(t).drawableHandle),rt.delete(t),st.add(t),at.delete(t))}}}function ht(t,e){const{requirements:n}=ot[e];ot[e].name;const o=function([t]){const e=t.filter(([t,e])=>e>U[t]).map(([t,e])=>`${e-U[t]} ${t}`);if(e.length>0)return"missing: "+e.join(", ")}(n);o?tt({text:o,offset:-1,opacity:0}):(it(t,e),function([t]){for(const[e,n]of t)U[e]-=n}(n))}function dt({name:t,hex:e}){return n=>{const o=e.toCanvas();if(e.equal(null!=(r=$)?r:null==(s=j)?void 0:s.hex)){n.beginPath();const[t,...e]=i;n.moveTo(...o.add(t).toArray());for(const t of e)n.lineTo(...o.add(t).toArray());n.closePath(),n.fillStyle="#fff9",n.fill()}var r,s;t&&x(n,t,[0,0,0],...o.toArray(),.5,.5)}}let mt=0;const wt=[1,2],vt=[3,5],xt={0:"springgreen",1:"forestgreen",2:"sienna",3:"gold"};function yt({terrain:t,hex:e}){return n=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=xt[t];const o=e.toCanvas();n.beginPath();const[r,...s]=i;n.moveTo(...o.add(r).toArray());for(const t of s)n.lineTo(...o.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}let gt=0;document.title="setlerio",n(3,(function(t){W(()=>{let e=0;t.fillStyle="white";for(const n of[...V].reverse()){e+=1+n.offset,t.globalAlpha=n.opacity;const o=1e3-88*e;t.fillRect(528,o,448,64),x(t,n.text,[0,0,0],552,o+32,0,.5)}})})),n(3,(function(t){W(()=>{t.fillStyle="white",t.fillRect(0,0,1e3,48),x(t,Object.entries(U).map(([t,e])=>`${t}: ${String(e).padStart(4," ")}`).join("   "),[0,0,0],24,24,0,.5)})})),function(){const t=new Map,e=new Set(l.map(t=>t.toHash()));function o(n,r,[s,a],i=!1,c=s+Math.random()*(a-s)){if((i||!e.has(r.toHash()))&&!(c<=0)){t.set(r.toHash(),n),o(n,r.add(l[Math.floor(Math.random()*l.length)]),[0,0],i,c-1);for(const t of l)e.add(r.add(t).toHash())}}for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o(3,new s(e,t),wt,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const r=new s(n,e);if(!t.has(r.toHash())){const e=Math.random();e<.4?t.set(r.toHash(),0):e<.85?t.set(r.toHash(),1):e<.95?o(2,r,vt):o(3,r,wt)}t.has(r.toHash())||t.set(r.toHash(),0)}t.set(new s(0,0).toHash(),0);for(const[e,o]of t.entries()){const t=a(e);n(0,yt({terrain:o,hex:t}),t)}}(),document.body.append(q),q.addEventListener("mousemove",t=>{j=B(z(t))}),document.addEventListener("mousemove",t=>{T&&(j=B(z(t)),!R&&T.relative.distance(j.relative)>5&&(R=!0),R&&(F=J(j.relative,T.canvas),j=B(z(t))))}),q.addEventListener("contextmenu",t=>{t.preventDefault()}),q.addEventListener("wheel",({deltaY:t})=>{$&&(A(),$=void 0),j&&(P=Math.max(.5,Math.min(1,P-.0625*Math.sign(t))),F=J(j.relative,j.canvas))}),q.addEventListener("mouseout",()=>{R||(j=void 0)}),q.addEventListener("mousedown",t=>{if(t.preventDefault(),j=B(z(t)),$){if(function(t){for(const[e,[,n]]of S.entries())if(L(t,e))return Array.isArray(n)?C(n):(A(),n()),!0;return A(),!1}(j.relative))return I=!0,void(b||($=void 0));$.equal(j.hex)&&(I=!0),$=void 0}T=j}),q.addEventListener("mouseup",t=>{if(j=B(z(t)),!R&&!I&&T&&T.hex.equal(j.hex)){const t=function(t){const e=t.toHash();if(!rt.has(e))return;const n=rt.get(e);return"blank"===n.name?[["build",[[ot.lumberjackHut.name,()=>ht(t,"lumberjackHut")],[ot.tower.name,()=>ht(t,"tower")]]]]:ot[n.name].indestructible?void 0:[["destroy",()=>function(t){ct(t)}(t)]]}(T.hex);t&&($=T.hex,C(t,T.relative))}}),document.addEventListener("mouseup",()=>{j&&(j.relative.x<0||j.relative.y<0||j.relative.x>1e3||j.relative.y>1e3)&&(j=void 0),T=void 0,R=!1,I=!1}),document.addEventListener("visibilitychange",()=>{j=void 0,T=void 0,R=!1,I=!1}),n(2,(function(t){t.beginPath();for(const e of at){const n=a(e),o=n.toCanvas();for(let e=0;e<6;e+=1)rt.has(n.add(l[e]).toHash())||(t.moveTo(...o.add(i[e]).toArray()),t.lineTo(...o.add(i[(e+1)%6]).toArray()))}t.lineJoin="round",t.lineWidth=4,t.strokeStyle="white",t.lineDashOffset=mt,t.setLineDash([6,4]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])})),Q({run:function(t){mt=.20833333333333331*t%10},duration:1/0}),it(new s(0,0),"townCenter"),it(new s(2,-2),"tower"),it(new s(3,-1),"tower"),ct(new s(2,-2)),function t(n){requestAnimationFrame(t),n>=gt+15.666666666666668&&(gt=n,Y+=1,function(){const t=[];for(const[e,n]of K.entries()){const o=Y-n.frame;o>n.totalFrames?t.push(e):o>=0&&n.run(o,n.totalFrames)}for(const e of t.reverse())K.splice(e,1)}(),function(){D.resetTransform(),D.clearRect(0,0,1e3,1e3),D.translate(500,500),D.scale(P,P),D.translate(-F.x,-F.y);const t=[[],[],[],[],[]],n=F.toHex();for(const[o,r,s]of e.values())s&&!N(s,n)||t[o].push(r);for(const e of t)for(const t of e)t(D)}())}(0);</script>
