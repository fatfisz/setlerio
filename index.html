<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";class t{constructor(t,n){this.x=t,this.y=n}add(n){return new t(this.x+n.x,this.y+n.y)}addCoords(n,e){return new t(this.x+n,this.y+e)}sub(n){return new t(this.x-n.x,this.y-n.y)}toHex(){return new t(this.x/(o+n)+this.y/e,this.x/(o+n)-this.y/e)}toCanvas(){return new t((this.x+this.y)*(o+n)/2,(this.x-this.y)*e/2)}round(){return new t(Math.round(this.x),Math.round(this.y))}equal({x:t,y:n}){return this.x===t&&this.y===n}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}const n=160,e=.7*n,o=.5*n,r=[new t(0,-1),new t(1,-1),new t(-1,0),new t(0,0),new t(1,0),new t(-1,1),new t(0,1)];function a(t,n,[e,o,r]){t[n]=e,t[n+1]=o,t[n+2]=r,t[n+3]=255}function s(t,n){const e=document.createElement("canvas");e.width=t,e.height=n;const o=e.getContext("2d");return o.imageSmoothingEnabled=!1,[e,o]}const i=new Map;const u={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function c(t,n){return function(t,n){const e=String(t);return i.has(e)||i.set(e,n()),i.get(e)}(["text",t,n],()=>{const[e,o]=function(t){const n=t.split("\n");return[Math.max(...n.map(h)),9*n.length-3]}(t),[r,a]=s(e,o),i=a.createImageData(e,o);let c=0,m=0;for(const e of t)"\n"===e?(c+=9,m=0):(d(i,n,m,c,e),m+=1+l(u[e]));return a.putImageData(i,0,0),r})}function d(t,n,e,o,r){const s=u[r],i=l(s);for(let r=0;r<6*i;r+=1)if(s&1<<r){const s=e+r%i,u=o+Math.floor(r/i);a(t.data,4*(u*t.width+s),n)}}function h(t){return[...t].reduce((t,n)=>t+l(u[n]),1*Math.max(t.length-1,0))}function l(t){return(t.toString(2).length-1)/6}let m=0;const f=new Map;function w(t,n){return m+=1,f.set(m,y[t](n)),m}const x=[new t(-o/2,-e/2),new t(o/2,-e/2),new t(n/2,0),new t(o/2,e/2),new t(-o/2,e/2),new t(-n/2,0)],y={drawHex:({name:t,hex:n})=>(e,o,r,a,s)=>{e.lineJoin="round",e.lineWidth=3,e.strokeStyle="black",e.fillStyle="hotpink";const i=n.toCanvas().add(o);e.beginPath();const[u,...d]=x;e.moveTo(...i.add(u).round().toArray());for(const t of d)e.lineTo(...i.add(t).round().toArray());e.closePath(),s&&n.equal(a)&&e.fill(),e.stroke();const h=c(`[${n.x}, ${n.y}]\n${t}`,[0,0,0]);e.drawImage(h,...i.addCoords(1.5*-h.width,1.5*-h.height).round().toArray(),3*h.width,3*h.height)}};let g=0;function b(t=0){return g+1+p(t)}function p(t){return Math.round(.02*t)}class v{constructor({frame:t,duration:n=0,run:e}){this.frame=t,this.totalFrames=p(n),this.run=e}}const C=[];const E={food:0,wood:2,stone:10,iron:0,gold:0};const k={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},H=new Map;function M(){var n,e;H.clear(),n="townCenter",q(e=new t(0,0),n,!0),r.forEach(t=>{q(e.add(t),"blank",!1)})}function q(t,n,e){const o=t.toHash();if(H.has(o)){if(!e)return;r=H.get(o).drawableHandle,f.delete(r)}var r;H.set(o,{name:n,hex:t,drawableHandle:w("drawHex",{name:k[n].name,hex:t})})}function A(t){const n=document.createElement("button");n.textContent="Build "+k[t].name,n.addEventListener("click",()=>{!function(t){const n=k[t],e=(o=n.requirements,o.filter(([t,n])=>n>E[t]).map(([t])=>"Not enough "+t));var o;if(e.length>0){const t=document.createElement("pre");t.textContent=e.join("\n"),document.body.append(t),r={frame:b(5e3),run:()=>{document.body.removeChild(t)}},C.push(new v(r))}else!function(t){t.forEach(([t,n])=>{E[t]-=n})}(n.requirements);var r}(t)}),document.body.append(n)}const[S,j]=s(1e3,1e3),F=new t(500,500);let I=new t(0,0),L=new t(0,0),$=!1;function B(){document.body.append(S),S.addEventListener("mousemove",n=>{const{left:e,top:o,width:r,height:a}=S.getBoundingClientRect();I=new t((n.clientX-e)*(1e3/r),(n.clientY-o)*(1e3/a)),$=!0}),S.addEventListener("mouseout",()=>{$=!1})}function D(){j.clearRect(0,0,1e3,1e3),function(){const t=I.sub(F),a=t.toHex().round().toCanvas();r.forEach(r=>{const s=a.add(r.toCanvas());(function({x:t,y:r}){const a=Math.abs(t),s=Math.abs(r);return!(s>e/2||a>n/2)&&(a<=o/2||(n/2-a)/(n-o)>=s/e)})(t.sub(s))&&(L=s.toHex().round())})}();for(const t of f.values())t(j,F,I,L,$)}function P(){!function(){const t=[];C.forEach((n,e)=>{const o=g-n.frame;o>n.totalFrames?t.push(e):o<0||n.run(o,n.totalFrames)}),t.reverse().forEach(t=>{C.splice(t,1)})}(),D()}let R=0;document.title="setlerio",B(),M(),A("lumberjackHut"),A("tower"),function t(n){requestAnimationFrame(t),n>=R+49&&(R=n,g=b(),P())}(0);</script>
