<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const e=new Map;function n(...n){return t+=1,e.set(t,n),t}function o(t){e.delete(t)}let s=0;function a(t=0){return s+1+r(t)}function r(t){return Math.round(.06*t)}class i{constructor({frame:t=s+1,duration:e=0,run:n}){this.frame=t,this.totalFrames=r(e),this.run=n}}const d=[];function c(t){d.push(new i(t))}class u{constructor(t,e){this.x=t,this.y=e}add({x:t,y:e}){return new u(this.x+t,this.y+e)}mul(t){return new u(this.x*t,this.y*t)}sub({x:t,y:e}){return new u(this.x-t,this.y-e)}toHex(){return new u(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new u(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal({x:t,y:e}){return this.x===t&&this.y===e}distance({x:t,y:e}){return((this.x-t)**2+(this.y-e)**2)**.5}toArray(){return[this.x,this.y]}toHash(){return`${this.x},${this.y}`}}function f(t){const e=t.indexOf(","),n=Number(t.slice(0,e)),o=Number(t.slice(e+1));return new u(n,o)}const h=[new u(-40,-60),new u(40,-60),new u(80,0),new u(40,60),new u(-40,60),new u(-80,0)];function l(t,e=0){return 0===t?[new u(0,0)]:[...m(t).map((e,n,o)=>new u(e,o[(n+2*t)%o.length])),...t>e?l(t-1,e):[]]}function m(t){return[...w(t),...w(t).map(t=>-t)]}function w(t){return 0===t?[]:[-t,1-t,...w(t-1).map(t=>t+1),t]}const v=l(1);function x({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return o<=60&&(n<=40||80-n>=o*(80/120))}const g={food:1/0,wood:1/0,stone:1/0,iron:1/0,gold:1/0};function y(t,e,[n,o,s]){t[e]=n,t[e+1]=o,t[e+2]=s,t[e+3]=255}function b(t,e){const n=document.createElement("canvas");n.width=t,n.height=e;const o=n.getContext("2d");return o.imageSmoothingEnabled=!1,[n,o]}const H=new Map;const p={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function M(t,e){return function(t,e){const n=String(t);return H.has(n)||H.set(n,e()),H.get(n)}(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(k)),9*e.length-3]}(t),[s,a]=b(n,o),r=a.createImageData(n,o);let i=0,d=0;for(const n of t)"\n"===n?(i+=9,d=0):(C(r,e,d,i,n),d+=1+E(p[n]));return a.putImageData(r,0,0),s})}function C(t,e,n,o,s){const a=p[s],r=E(a);for(let s=0;s<6*r;s+=1)if(a&1<<s){const a=n+s%r,i=o+Math.floor(s/r);y(t.data,4*(i*t.width+a),e)}}function k(t){return[...t].reduce((t,e)=>t+E(p[e]),1*Math.max(t.length-1,0))}function E(t){return(t.toString(2).length-1)/6}const S={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},L=new Map,q=new Set,A=new Set;let D=!1;function T(){var t;D||(n(B),c({run:J,duration:1/0}),D=!0),L.clear(),j(new u(0,0),"townCenter"),j(new u(2,-2),"tower"),j(new u(3,-1),"tower"),t=new u(2,-2),L.has(t.toHash()),["townCenter","tower"].includes(L.get(t.toHash()).name),F(t,"blank",!0),P(t)}function j(t,e){F(t,e,!0),P(t)}function F(t,e,s){const a=t.toHash();if(L.has(a)){if(!s)return;o(L.get(a).drawableHandle)}L.set(a,{name:e,hex:t,drawableHandle:n(N({name:S[e].name,hex:t}),t)})}function P(t){if("blank"!==L.get(t.toHash()).name){const e=new Set;for(const n of l(4)){const o=L.get(t.add(n).toHash());if(o&&("townCenter"===o.name||"tower"===o.name))for(const t of l(1))e.add(o.hex.add(t).toHash())}for(const e of l(2))F(t.add(e),"blank",!1);for(const n of l(2,2)){const o=t.add(n).toHash();e.has(o)||A.add(o)}for(const e of l(1)){const n=t.add(e).toHash();A.delete(n)}}else{const e=new Set,n=new Set;for(const o of l(4)){const s=L.get(t.add(o).toHash());if(s&&("townCenter"===s.name||"tower"===s.name)){for(const t of l(2,2))e.add(s.hex.add(t).toHash());for(const t of l(1))n.add(s.hex.add(t).toHash())}}for(const t of n)e.delete(t);for(const s of l(2)){const a=t.add(s).toHash();if(e.has(a))A.add(a);else if(!n.has(a)){o(L.get(a).drawableHandle),L.delete(a),q.add(a),A.delete(a)}}}}function I(t){const e=document.createElement("button");e.textContent="Build "+S[t].name,e.addEventListener("click",()=>{!function(t){const e=S[t],n=(o=e.requirements,o.filter(([t,e])=>e>g[t]).map(([t])=>"Not enough "+t));var o;if(n.length>0){const t=document.createElement("pre");t.textContent=n.join("\n"),document.body.append(t),c({frame:a(5e3),run:()=>{document.body.removeChild(t)}})}else!function(t){for(const[e,n]of t)g[e]-=n}(e.requirements)}(t)}),document.body.append(e)}function N({name:t,hex:e}){return(n,o)=>{const s=e.toCanvas();if(o&&e.equal(o)){n.beginPath();const[t,...e]=h;n.moveTo(...s.add(t).toArray());for(const t of e)n.lineTo(...s.add(t).toArray());n.closePath(),n.fillStyle="#fffa",n.fill()}const a=M(t,[0,0,0]);n.drawImage(a,...s.add(new u(a.width,a.height).mul(-1.5)).round().toArray(),3*a.width,3*a.height)}}let O=0;function B(t){t.beginPath();for(const e of A){const n=f(e),o=n.toCanvas();for(let e=0;e<6;e+=1)L.has(n.add(v[e]).toHash())||(t.moveTo(...o.add(h[e]).toArray()),t.lineTo(...o.add(h[(e+1)%6]).toArray()))}t.lineJoin="round",t.lineWidth=4,t.strokeStyle="white",t.lineDashOffset=O,t.setLineDash([6,4]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])}function J(t){O=.20833333333333331*t%10}const[R,W]=b(1e3,1e3);R.style.background="#D6EAF8";let Y,$,z,X,G,K,Q,U=new u(0,0),V=1;const Z=new u(500,500);function _(){document.body.append(R),R.addEventListener("mousemove",t=>{Y=tt(t),et()}),document.addEventListener("mousemove",t=>{G&&(Y=tt(t),!Q&&X.distance(Y)>5&&(Q=!0),Q&&(U=nt(G)),et())}),R.addEventListener("contextmenu",t=>{t.preventDefault()}),R.addEventListener("wheel",({deltaY:t})=>{$&&(V=Math.max(.5,Math.min(1,V-.0625*Math.sign(t))),U=nt($))}),R.addEventListener("mouseout",()=>{Q||(Y=void 0,$=void 0,z=void 0)}),R.addEventListener("mousedown",()=>{X=Y,G=$,K=z}),R.addEventListener("mouseup",()=>{!Q&&K&&z&&K.equal(z)&&console.log("clicked!")}),document.addEventListener("mouseup",()=>{Y&&(Y.x<0||Y.y<0||Y.x>1e3||Y.y>1e3)&&(Y=void 0,$=void 0,z=void 0),X=void 0,G=void 0,K=void 0,Q=!1}),document.addEventListener("visibilitychange",()=>{Y=void 0,$=void 0,z=void 0,X=void 0,G=void 0,K=void 0,Q=!1})}function tt({clientX:t,clientY:e}){const{left:n,top:o,width:s,height:a}=R.getBoundingClientRect();return new u(1e3/s*(t-n),1e3/a*(e-o))}function et(){$=Y.sub(Z).mul(1/V).add(U);const t=$.toHex().round().toCanvas();for(const e of v){const n=t.add(e.toCanvas());x($.sub(n))&&(z=n.toHex())}}function nt(t){return Y.sub(Z).mul(1/V).sub(t).mul(-1)}function ot(){W.resetTransform(),W.clearRect(0,0,1e3,1e3),W.translate(500,500),W.scale(V,V),W.translate(-U.x,-U.y);const t=U.toHex();for(const[n,o]of e.values())o&&!st(o,t)||n(W,z)}function st(t,e){const{x:n,y:o}=t.sub(e).toCanvas();return Math.abs(n)<=1160&&Math.abs(o)<=1120}const at=[1,2],rt=[3,5];const it={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold"};function dt({terrain:t,hex:e}){return n=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=it[t];const o=e.toCanvas();n.beginPath();const[s,...a]=h;n.moveTo(...o.add(s).toArray());for(const t of a)n.lineTo(...o.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}function ct(){!function(){const t=[];for(const[e,n]of d.entries()){const o=s-n.frame;if(o>n.totalFrames)return void t.push(e);if(o<0)return;n.run(o,n.totalFrames)}for(const e of t.reverse())d.splice(e,1)}(),ot()}let ut=0;document.title="setlerio",function(){const t=new Map,e=new Set(v.map(t=>t.toHash()));function o(n,s,[a,r],i=!1,d=a+Math.random()*(r-a)){if((i||!e.has(s.toHash()))&&!(d<=0)){t.set(s.toHash(),n),o(n,s.add(v[Math.floor(Math.random()*v.length)]),[0,0],i,d-1);for(const t of v)e.add(s.add(t).toHash())}}for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o("desert",new u(e,t),at,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const s=new u(n,e);if(t.has(s.toHash()))continue;const a=Math.random();a<.4?t.set(s.toHash(),"meadow"):a<.85?t.set(s.toHash(),"forest"):a<.95?o("mountains",s,rt):o("desert",s,at),t.has(s.toHash())||t.set(s.toHash(),"meadow")}t.set(new u(0,0).toHash(),"meadow");for(const[e,o]of t.entries()){const t=f(e);n(dt({terrain:o,hex:t}),t)}}(),_(),T(),I("lumberjackHut"),I("tower"),function t(e){requestAnimationFrame(t),e>=ut+15.666666666666668&&(ut=e,s=a(),ct())}(0);</script>
