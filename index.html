<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%)}</style><body><script>"use strict";let t=0;const e=new Map;function n(...n){return t+=1,e.set(t,n),t}function o(t){e.delete(t)}function a(t,e,n=!1){const o=document.createElement("canvas");o.width=t,o.height=e;const a=o.getContext("2d");return a.imageSmoothingEnabled=n,[o,a]}class s{constructor(t,e){this.x=t,this.y=e}add({x:t,y:e}){return new s(this.x+t,this.y+e)}mul(t){return new s(this.x*t,this.y*t)}sub({x:t,y:e}){return new s(this.x-t,this.y-e)}toHex(){return new s(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new s(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new s(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance({x:t,y:e}){return((this.x-t)**2+(this.y-e)**2)**.5}toArray(){return[this.x,this.y]}toHash(){return`${this.x},${this.y}`}}function r(t){const e=t.indexOf(",");return new s(Number(t.slice(0,e)),Number(t.slice(e+1)))}const i=[new s(-40,-60),new s(40,-60),new s(80,0),new s(40,60),new s(-40,60),new s(-80,0)];function c(t,e,n=0){return 0===e?[t]:[...u(e).map((n,o,a)=>new s(t.x+n,t.y+a[(o+2*e)%a.length])),...e>n?c(t,e-1,n):[]]}function u(t){return[...h(t),...h(t).map(t=>-t)]}function h(t){return 0===t?[]:[-t,1-t,...h(t-1).map(t=>t+1),t]}const d=c(new s(0,0),1);function f({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return o<=60&&(n<=40||80-n>=o*(80/120))}const[l,m]=a(1e3,1e3,!0);l.style.background="#D6EAF8";let w,v,x,g=new s(0,0),y=1;const b=new s(500,500);function H(){document.body.append(l),l.addEventListener("mousemove",t=>{w=M(p(t))}),document.addEventListener("mousemove",t=>{v&&(w=M(p(t)),!x&&v.relative.distance(w.relative)>5&&(x=!0),x&&(g=k(w.relative,v.canvas),w=M(p(t))))}),l.addEventListener("contextmenu",t=>{t.preventDefault()}),l.addEventListener("wheel",({deltaY:t})=>{w&&(y=Math.max(.5,Math.min(1,y-.0625*Math.sign(t))),g=k(w.relative,w.canvas))}),l.addEventListener("mouseout",()=>{x||(w=void 0)}),l.addEventListener("mousedown",t=>{t.preventDefault(),v=w}),l.addEventListener("mouseup",t=>{w=M(p(t)),!x&&v&&v.hex.equal(w.hex)&&console.log("clicked!")}),document.addEventListener("mouseup",()=>{w&&(w.relative.x<0||w.relative.y<0||w.relative.x>1e3||w.relative.y>1e3)&&(w=void 0),v=void 0,x=!1}),document.addEventListener("visibilitychange",()=>{w=void 0,v=void 0,x=!1})}function p({clientX:t,clientY:e}){const{left:n,top:o,width:a,height:r}=l.getBoundingClientRect();return new s(1e3/a*(t-n),1e3/r*(e-o))}function M(t){const e=t.sub(b).mul(1/y).add(g),n={relative:t,canvas:e,hex:new s(0,0)},o=e.toHex().round().toCanvas();for(const t of d){const a=o.add(t.toCanvas());f(e.sub(a))&&(n.hex=a.toHex())}return n}function k(t,e){return t.sub(b).mul(1/y).sub(e).mul(-1)}function C(){m.resetTransform(),m.clearRect(0,0,1e3,1e3),m.translate(500,500),m.scale(y,y),m.translate(-g.x,-g.y);const t=g.toHex();for(const[n,o]of e.values())o&&!E(o,t)||n(m)}function E(t,e){const{x:n,y:o}=t.sub(e).toCanvas();return Math.abs(n)<=1160&&Math.abs(o)<=1120}let S=0;function L(){S=function(t=0){return S+1+A(t)}()}function A(t){return Math.round(.06*t)}class q{constructor({frame:t=S+1,duration:e=0,run:n}){this.frame=t,this.totalFrames=A(e),this.run=n}}const D=[];function T(t,e,[n,o,a]){t[e]=n,t[e+1]=o,t[e+2]=a,t[e+3]=255}const F=new Map;function P(t,e){const n=String(t);return F.has(n)||F.set(n,e()),F.get(n)}const I={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function j(t,e,n,o,s,r=0,i=0,c=3){const u=P([e,n,c],()=>{const t=function(t,e){return P(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(B)),9*e.length-3]}(t),[s,r]=a(n,o),i=r.createImageData(n,o);let c=0,u=0;for(const n of t)"\n"===n?(c+=9,u=0):(O(i,e,u,c,n),u+=1+J(I[n]));return r.putImageData(i,0,0),s})}(e,n),[o,s]=a(t.width*c,t.height*c);return s.drawImage(t,0,0,t.width*c,t.height*c),o});t.drawImage(u,o-u.width*r,s-u.height*i)}function O(t,e,n,o,a){const s=I[a],r=J(s);for(let a=0;a<6*r;a+=1)if(s&1<<a){const s=n+a%r,i=o+Math.floor(a/r);T(t.data,4*(i*t.width+s),e)}}function B(t){return[...t].reduce((t,e)=>t+J(I[e]),1*Math.max(t.length-1,0))}function J(t){return(t.toString(2).length-1)/6}const N={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},R=new Map,W=new Set,Y=new Set;let $=!1;function z(){var t,e;$||(n(V),t={run:Z,duration:1/0},D.push(new q(t)),$=!0),R.clear(),X(new s(0,0),"townCenter"),X(new s(2,-2),"tower"),X(new s(3,-1),"tower"),G(e=new s(2,-2),"blank",!0),K(e)}function X(t,e){G(t,e,!0),K(t)}function G(t,e,a){const s=t.toHash();if(R.has(s)){if(!a)return;o(R.get(s).drawableHandle)}R.set(s,{name:e,hex:t,drawableHandle:n(Q({name:N[e].name,hex:t}),t)})}function K(t){const e=new Set,n=new Set;if("blank"!==R.get(t.toHash()).name){for(const e of c(t,4)){const t=R.get(e.toHash());if(t&&("townCenter"===t.name||"tower"===t.name))for(const e of c(t.hex,1))n.add(e.toHash())}for(const e of c(t,2))G(e,"blank",!1);for(const e of c(t,2,2)){const t=e.toHash();n.has(t)||Y.add(t)}for(const e of c(t,1)){const t=e.toHash();Y.delete(t)}}else{for(const o of c(t,4)){const t=R.get(o.toHash());if(t&&("townCenter"===t.name||"tower"===t.name)){for(const n of c(t.hex,2,2))e.add(n.toHash());for(const e of c(t.hex,1))n.add(e.toHash())}}for(const t of n)e.delete(t);for(const a of c(t,2)){const t=a.toHash();e.has(t)?Y.add(t):n.has(t)||(o(R.get(t).drawableHandle),R.delete(t),W.add(t),Y.delete(t))}}}function Q({name:t,hex:e}){return n=>{const o=e.toCanvas();if(e.equal(null==(a=w)?void 0:a.hex)){n.beginPath();const[t,...e]=i;n.moveTo(...o.add(t).toArray());for(const t of e)n.lineTo(...o.add(t).toArray());n.closePath(),n.fillStyle="#fffa",n.fill()}var a;j(n,t,[0,0,0],...o.toArray(),.5,.5)}}let U=0;function V(t){t.beginPath();for(const e of Y){const n=r(e),o=n.toCanvas();for(let e=0;e<6;e+=1)R.has(n.add(d[e]).toHash())||(t.moveTo(...o.add(i[e]).toArray()),t.lineTo(...o.add(i[(e+1)%6]).toArray()))}t.lineJoin="round",t.lineWidth=4,t.strokeStyle="white",t.lineDashOffset=U,t.setLineDash([6,4]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])}function Z(t){U=.20833333333333331*t%10}const _=[1,2],tt=[3,5];const et={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold"};function nt({terrain:t,hex:e}){return n=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=et[t];const o=e.toCanvas();n.beginPath();const[a,...s]=i;n.moveTo(...o.add(a).toArray());for(const t of s)n.lineTo(...o.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}function ot(){!function(){const t=[];for(const[e,n]of D.entries()){const o=S-n.frame;if(o>n.totalFrames)return void t.push(e);if(o<0)return;n.run(o,n.totalFrames)}for(const e of t.reverse())D.splice(e,1)}(),C()}let at=0;document.title="setlerio",function(){const t=new Map,e=new Set(d.map(t=>t.toHash()));function o(n,a,[s,r],i=!1,c=s+Math.random()*(r-s)){if((i||!e.has(a.toHash()))&&!(c<=0)){t.set(a.toHash(),n),o(n,a.add(d[Math.floor(Math.random()*d.length)]),[0,0],i,c-1);for(const t of d)e.add(a.add(t).toHash())}}for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o("desert",new s(e,t),_,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const a=new s(n,e);if(t.has(a.toHash()))continue;const r=Math.random();r<.4?t.set(a.toHash(),"meadow"):r<.85?t.set(a.toHash(),"forest"):r<.95?o("mountains",a,tt):o("desert",a,_),t.has(a.toHash())||t.set(a.toHash(),"meadow")}t.set(new s(0,0).toHash(),"meadow");for(const[e,o]of t.entries()){const t=r(e);n(nt({terrain:o,hex:t}),t)}}(),H(),z(),function t(e){requestAnimationFrame(t),e>=at+15.666666666666668&&(at=e,L(),ot())}(0);</script>
