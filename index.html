<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";const t={food:0,wood:2,stone:10,iron:0,gold:0};let n=0;function e(t=0){return n+1+o(t)}function o(t){return Math.round(.02*t)}class r{constructor({frame:t,duration:n=0,run:e}){this.frame=t,this.totalFrames=o(n),this.run=e}}const s=[];const u={townCenter:{name:"town center",count:1,requirements:[]},lumberjackHut:{name:"lumberjack's hut",count:0,requirements:[["wood",2],["stone",2]]},tower:{name:"tower",count:0,requirements:[["wood",2],["stone",3]]}};function i(n){const o=document.createElement("button");o.textContent="Build "+u[n].name,o.addEventListener("click",()=>{!function(n){const o=u[n],i=(a=o.requirements,a.filter(([n,e])=>e>t[n]).map(([t])=>"Not enough "+t));var a;if(i.length>0){const t=document.createElement("pre");t.textContent=i.join("\n"),document.body.append(t),c={frame:e(5e3),run:()=>{document.body.removeChild(t)}},s.push(new r(c))}else!function(n){n.forEach(([n,e])=>{t[n]-=e})}(o.requirements),o.count+=1;var c}(n)}),document.body.append(o)}function a(t,n){const e=document.createElement("canvas");e.width=t,e.height=n;const o=e.getContext("2d");return o.imageSmoothingEnabled=!1,[e,o]}class c{constructor(t,n){this.x=t,this.y=n}add(t){return new c(this.x+t.x,this.y+t.y)}addCoords(t,n){return new c(this.x+t,this.y+n)}sub(t){return new c(this.x-t.x,this.y-t.y)}toHex(){return new c(this.x/240+this.y/112,this.x/240-this.y/112)}toCanvas(){return new c(240*(this.x+this.y)/2,112*(this.x-this.y)/2)}round(){return new c(Math.round(this.x),Math.round(this.y))}equal({x:t,y:n}){return this.x===t&&this.y===n}toArray(){return[this.x,this.y]}}function d(t,n,[e,o,r]){t[n]=e,t[n+1]=o,t[n+2]=r,t[n+3]=255}const h=new Map;const l={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function f(t,n){return function(t,n){const e=String(t);return h.has(e)||h.set(e,n()),h.get(e)}(["text",t,n],()=>{const[e,o]=function(t){const n=t.split("\n");return[Math.max(...n.map(w)),9*n.length-3]}(t),[r,s]=a(e,o),u=s.createImageData(e,o);let i=0,c=0;for(const e of t)"\n"===e?(i+=9,c=0):(m(u,n,c,i,e),c+=1+y(l[e]));return s.putImageData(u,0,0),r})}function m(t,n,e,o,r){const s=l[r],u=y(s);for(let r=0;r<6*u;r+=1)if(s&1<<r){const s=e+r%u,i=o+Math.floor(r/u);d(t.data,4*(i*t.width+s),n)}}function w(t){return[...t].reduce((t,n)=>t+y(l[n]),1*Math.max(t.length-1,0))}function y(t){return(t.toString(2).length-1)/6}const[x,g]=a(1e3,1e3),p=[new c(-40,-56),new c(40,-56),new c(80,0),new c(40,56),new c(-40,56),new c(-80,0)],b=[new c(0,-1),new c(1,-1),new c(-1,0),new c(0,0),new c(1,0),new c(-1,1),new c(0,1)],v=[...b],C=new c(500,500);let E=new c(0,0),k=new c(0,0),q=!1;function M(){document.body.append(x),x.addEventListener("mousemove",t=>{const{left:n,top:e,width:o,height:r}=x.getBoundingClientRect();E=new c((t.clientX-n)*(1e3/o),(t.clientY-e)*(1e3/r)),q=!0}),x.addEventListener("mouseout",()=>{q=!1})}function j(){g.clearRect(0,0,1e3,1e3),function(){const t=E.sub(C),n=t.toHex().round().toCanvas();b.forEach(e=>{const o=n.add(e.toCanvas());(function({x:t,y:n}){const e=Math.abs(t),o=Math.abs(n);if(o>56||e>80)return!1;if(e<=40)return!0;return(80-e)/80>=o/112})(t.sub(o))&&(k=o.toHex().round())})}(),g.lineJoin="round",g.lineWidth=3,g.strokeStyle="black",g.fillStyle="hotpink";for(const t of v)A(t)}function A(t){const n=t.toCanvas().add(C);g.beginPath();const[e,...o]=p;g.moveTo(...n.add(e).round().toArray());for(const t of o)g.lineTo(...n.add(t).round().toArray());g.closePath(),q&&t.equal(k)&&g.fill(),g.stroke();const r=f(`[${t.x}, ${t.y}]`,[0,0,0]);g.drawImage(r,...n.addCoords(1.5*-r.width,1.5*-r.height).round().toArray(),3*r.width,3*r.height)}function H(){!function(){const t=[];s.forEach((e,o)=>{const r=n-e.frame;r>e.totalFrames?t.push(o):r<0||e.run(r,e.totalFrames)}),t.reverse().forEach(t=>{s.splice(t,1)})}(),j()}let S=0;document.title="setlerio",M(),i("lumberjackHut"),i("tower"),function t(o){requestAnimationFrame(t),o>=S+49&&(S=o,n=e(),H())}(0);</script>
