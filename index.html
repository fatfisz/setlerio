<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const n=new Map;let e=0;function o(t=0){return e+1+r(t)}function r(t){return Math.round(.02*t)}class a{constructor({frame:t,duration:n=0,run:e}){this.frame=t,this.totalFrames=r(n),this.run=e}}const s=[];class i{constructor(t,n){this.x=t,this.y=n}add(t){return new i(this.x+t.x,this.y+t.y)}addCoords(t,n){return new i(this.x+t,this.y+n)}sub(t){return new i(this.x-t.x,this.y-t.y)}toHex(){return new i(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new i(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new i(Math.round(this.x),Math.round(this.y))}equal({x:t,y:n}){return this.x===t&&this.y===n}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}const u=[new i(-40,-60),new i(40,-60),new i(80,0),new i(40,60),new i(-40,60),new i(-80,0)],c=[new i(0,-1),new i(1,-1),new i(-1,0),new i(0,0),new i(1,0),new i(-1,1),new i(0,1)];const d={food:0,wood:2,stone:10,iron:0,gold:0};function h(t,n,[e,o,r]){t[n]=e,t[n+1]=o,t[n+2]=r,t[n+3]=255}function l(t,n){const e=document.createElement("canvas");e.width=t,e.height=n;const o=e.getContext("2d");return o.imageSmoothingEnabled=!1,[e,o]}const m=new Map;const f={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function w(t,n){return function(t,n){const e=String(t);return m.has(e)||m.set(e,n()),m.get(e)}(["text",t,n],()=>{const[e,o]=function(t){const n=t.split("\n");return[Math.max(...n.map(y)),9*n.length-3]}(t),[r,a]=l(e,o),s=a.createImageData(e,o);let i=0,u=0;for(const e of t)"\n"===e?(i+=9,u=0):(x(s,n,u,i,e),u+=1+g(f[e]));return a.putImageData(s,0,0),r})}function x(t,n,e,o,r){const a=f[r],s=g(a);for(let r=0;r<6*s;r+=1)if(a&1<<r){const a=e+r%s,i=o+Math.floor(r/s);h(t.data,4*(i*t.width+a),n)}}function y(t){return[...t].reduce((t,n)=>t+g(f[n]),1*Math.max(t.length-1,0))}function g(t){return(t.toString(2).length-1)/6}const b={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},p=new Map;function v(){var t,n;p.clear(),t="townCenter",C(n=new i(0,0),t,!0),c.forEach(t=>{C(n.add(t),"blank",!1)})}function C(e,o,r){const a=e.toHash();if(p.has(a)){if(!r)return;s=p.get(a).drawableHandle,n.delete(s)}var s,i;p.set(a,{name:o,hex:e,drawableHandle:(i=k({name:b[o].name,hex:e}),t+=1,n.set(t,i),t)})}function E(t){const n=document.createElement("button");n.textContent="Build "+b[t].name,n.addEventListener("click",()=>{!function(t){const n=b[t],e=(r=n.requirements,r.filter(([t,n])=>n>d[t]).map(([t])=>"Not enough "+t));var r;if(e.length>0){const t=document.createElement("pre");t.textContent=e.join("\n"),document.body.append(t),i={frame:o(5e3),run:()=>{document.body.removeChild(t)}},s.push(new a(i))}else!function(t){t.forEach(([t,n])=>{d[t]-=n})}(n.requirements);var i}(t)}),document.body.append(n)}function k({name:t,hex:n}){return(e,o,r,a,s)=>{e.lineJoin="round",e.lineWidth=3,e.strokeStyle="black",e.fillStyle="hotpink";const i=n.toCanvas().add(o);e.beginPath();const[c,...d]=u;e.moveTo(...i.add(c).round().toArray());for(const t of d)e.lineTo(...i.add(t).round().toArray());e.closePath(),s&&n.equal(a)&&e.fill(),e.stroke();const h=w(`[${n.x}, ${n.y}]\n${t}`,[0,0,0]);e.drawImage(h,...i.addCoords(1.5*-h.width,1.5*-h.height).round().toArray(),3*h.width,3*h.height)}}const[M,q]=l(1e3,1e3),H=new i(500,500);let A=new i(0,0),S=new i(0,0),j=!1;function F(){document.body.append(M),M.addEventListener("mousemove",t=>{const{left:n,top:e,width:o,height:r}=M.getBoundingClientRect();A=new i((t.clientX-n)*(1e3/o),(t.clientY-e)*(1e3/r)),j=!0}),M.addEventListener("mouseout",()=>{j=!1})}function I(){q.clearRect(0,0,1e3,1e3),function(){const t=A.sub(H),n=t.toHex().round().toCanvas();c.forEach(e=>{const o=n.add(e.toCanvas());(function({x:t,y:n}){const e=Math.abs(t),o=Math.abs(n);return!(o>60||e>80)&&(e<=40||(80-e)/80>=o/120)})(t.sub(o))&&(S=o.toHex().round())})}();for(const t of n.values())t(q,H,A,S,j)}function L(){!function(){const t=[];s.forEach((n,o)=>{const r=e-n.frame;r>n.totalFrames?t.push(o):r<0||n.run(r,n.totalFrames)}),t.reverse().forEach(t=>{s.splice(t,1)})}(),I()}let $=0;document.title="setlerio",F(),v(),E("lumberjackHut"),E("tower"),function t(n){requestAnimationFrame(t),n>=$+49&&($=n,e=o(),L())}(0);</script>
