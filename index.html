<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const e=new Map;function n(...n){return t+=1,e.set(t,n),t}let o=0;function r(t=0){return o+1+s(t)}function s(t){return Math.round(.06*t)}class a{constructor({frame:t,duration:e=0,run:n}){this.frame=t,this.totalFrames=s(e),this.run=n}}const i=[];class u{constructor(t,e){this.x=t,this.y=e}add(t){return new u(this.x+t.x,this.y+t.y)}mul(t){return new u(this.x*t,this.y*t)}addCoords(t,e){return new u(this.x+t,this.y+e)}sub(t){return new u(this.x-t.x,this.y-t.y)}subCoords(t,e){return new u(this.x-t,this.y-e)}toHex(){return new u(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new u(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal({x:t,y:e}){return this.x===t&&this.y===e}distance({x:t,y:e}){return((this.x-t)**2+(this.y-e)**2)**.5}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}function d(t){t.split(",").length,isNaN(Number(t.split(",")[0])),isNaN(Number(t.split(",")[1]));const[e,n]=t.split(",");return new u(Number(e),Number(n))}const c=[new u(-40,-60),new u(40,-60),new u(80,0),new u(40,60),new u(-40,60),new u(-80,0)],h=[new u(0,-1),new u(1,-1),new u(-1,0),new u(0,0),new u(1,0),new u(-1,1),new u(0,1)];function l({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return!(o>60||n>80)&&(n<=40||(80-n)/80>=o/120)}const f={food:1/0,wood:1/0,stone:1/0,iron:1/0,gold:1/0};function m(t,e,[n,o,r]){t[e]=n,t[e+1]=o,t[e+2]=r,t[e+3]=255}function w(t,e){const n=document.createElement("canvas");n.width=t,n.height=e;const o=n.getContext("2d");return o.imageSmoothingEnabled=!1,[n,o]}const v=new Map;const x={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function y(t,e){return function(t,e){const n=String(t);return v.has(n)||v.set(n,e()),v.get(n)}(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(b)),9*e.length-3]}(t),[r,s]=w(n,o),a=s.createImageData(n,o);let i=0,u=0;for(const n of t)"\n"===n?(i+=9,u=0):(g(a,e,u,i,n),u+=1+p(x[n]));return s.putImageData(a,0,0),r})}function g(t,e,n,o,r){const s=x[r],a=p(s);for(let r=0;r<6*a;r+=1)if(s&1<<r){const s=n+r%a,i=o+Math.floor(r/a);m(t.data,4*(i*t.width+s),e)}}function b(t){return[...t].reduce((t,e)=>t+p(x[e]),1*Math.max(t.length-1,0))}function p(t){return(t.toString(2).length-1)/6}const M={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},H=new Map;function C(){H.clear(),function(t,e){k(e,t,!0);for(const t of h)k(e.add(t),"blank",!1)}("townCenter",new u(0,0))}function k(t,o,r){const s=t.toHash();if(H.has(s)){if(!r)return;a=H.get(s).drawableHandle,e.delete(a)}var a;H.set(s,{name:o,hex:t,drawableHandle:n(q({name:M[o].name,hex:t}),t)})}function E(t){const e=document.createElement("button");e.textContent="Build "+M[t].name,e.addEventListener("click",()=>{!function(t){const e=M[t],n=(o=e.requirements,o.filter(([t,e])=>e>f[t]).map(([t])=>"Not enough "+t));var o;if(n.length>0){const t=document.createElement("pre");t.textContent=n.join("\n"),document.body.append(t),s={frame:r(5e3),run:()=>{document.body.removeChild(t)}},i.push(new a(s))}else!function(t){for(const[e,n]of t)f[e]-=n}(e.requirements);var s}(t)}),document.body.append(e)}function q({name:t,hex:e}){return(n,o)=>{n.lineJoin="round",n.lineWidth=3,n.strokeStyle="black",n.fillStyle="hotpink";const r=e.toCanvas();n.beginPath();const[s,...a]=c;n.moveTo(...r.add(s).toArray());for(const t of a)n.lineTo(...r.add(t).toArray());n.closePath(),o&&e.equal(o)&&n.fill(),n.stroke();const i=y(`[${e.x}, ${e.y}]\n${t}`,[0,0,0]);n.drawImage(i,...r.addCoords(1.5*-i.width,1.5*-i.height).round().toArray(),3*i.width,3*i.height)}}const[L,A]=w(1e3,1e3);L.style.background="#D6EAF8";let N,S,j,F,T,D,P,I=new u(0,0),$=1;function B(){document.body.append(L),L.addEventListener("mousemove",t=>{N=J(t),R()}),document.addEventListener("mousemove",t=>{T&&(N=J(t),!P&&F.distance(N)>5&&(P=!0),P&&(I=z(T)),R())}),L.addEventListener("contextmenu",t=>{t.preventDefault()}),L.addEventListener("wheel",({deltaY:t})=>{S&&($=Math.max(.5,Math.min(1,$-.0625*Math.sign(t))),I=z(S))}),L.addEventListener("mouseout",()=>{P||(N=void 0,S=void 0,j=void 0)}),L.addEventListener("mousedown",()=>{F=N,T=S,D=j}),L.addEventListener("mouseup",()=>{!P&&D&&j&&D.equal(j)&&console.log("clicked!")}),document.addEventListener("mouseup",()=>{N&&(N.x<0||N.y<0||N.x>1e3||N.y>1e3)&&(N=void 0,S=void 0,j=void 0),F=void 0,T=void 0,D=void 0,P=!1}),document.addEventListener("visibilitychange",()=>{N=void 0,S=void 0,j=void 0,F=void 0,T=void 0,D=void 0,P=!1})}function J({clientX:t,clientY:e}){const{left:n,top:o,width:r,height:s}=L.getBoundingClientRect();return new u(1e3/r*(t-n),1e3/s*(e-o))}function R(){S=N.subCoords(500,500).mul(1/$).add(I);const t=S.toHex().round().toCanvas();for(const e of h){const n=t.add(e.toCanvas());l(S.sub(n))&&(j=n.toHex())}}function W(){A.resetTransform(),A.clearRect(0,0,1e3,1e3),A.translate(500,500),A.scale($,$),A.translate(-I.x,-I.y);const t=I.toHex().round();for(const[n,o]of e.values())o&&!Y(o,t)||n(A,j)}function Y(t,e){const{x:n,y:o}=t.sub(e);return Math.abs(n+o)<=9.333333333333334&&Math.abs(n-o)<=18.666666666666668}function z(t){return N.subCoords(500,500).mul(1/$).sub(t).mul(-1)}const X=[1,2],G=[3,5];const K={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold"};function O({terrain:t,hex:e}){return n=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=K[t];const o=e.toCanvas();n.beginPath();const[r,...s]=c;n.moveTo(...o.add(r).toArray());for(const t of s)n.lineTo(...o.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}function Q(){!function(){const t=[];for(const[e,n]of i.entries()){const r=o-n.frame;if(r>n.totalFrames)return void t.push(e);if(r<0)return;n.run(r,n.totalFrames)}for(const e of t.reverse())i.splice(e,1)}(),W()}let U=0;document.title="setlerio",function(){const t=new Map,e=new Set(h.map(t=>t.toHash()));function o(n,r,[s,a],i=!1,u=s+Math.random()*(a-s)){if((i||!e.has(r.toHash()))&&!(u<=0)){t.set(r.toHash(),n),o(n,r.add(h[Math.floor(Math.random()*h.length)]),[0,0],i,u-1);for(const t of h)e.add(r.add(t).toHash())}}for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o("desert",new u(e,t),X,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const r=new u(n,e);if(t.has(r.toHash()))continue;const s=Math.random();s<.4?t.set(r.toHash(),"meadow"):s<.85?t.set(r.toHash(),"forest"):s<.95?o("mountains",r,G):o("desert",r,X),t.has(r.toHash())||t.set(r.toHash(),"meadow")}t.set(new u(0,0).toHash(),"meadow");for(const[e,o]of t.entries()){const t=d(e);n(O({terrain:o,hex:t}),t)}}(),B(),C(),E("lumberjackHut"),E("tower"),function t(e){requestAnimationFrame(t),e>=U+15.666666666666668&&(U=e,o=r(),Q())}(0);</script>
