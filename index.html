<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const e=new Map;function n(n){return t+=1,e.set(t,n),t}let o=0;function r(t=0){return o+1+s(t)}function s(t){return Math.round(.02*t)}class a{constructor({frame:t,duration:e=0,run:n}){this.frame=t,this.totalFrames=s(e),this.run=n}}const i=[];class c{constructor(t,e){this.x=t,this.y=e}add(t){return new c(this.x+t.x,this.y+t.y)}addCoords(t,e){return new c(this.x+t,this.y+e)}sub(t){return new c(this.x-t.x,this.y-t.y)}toHex(){return new c(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new c(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new c(Math.round(this.x),Math.round(this.y))}equal({x:t,y:e}){return this.x===t&&this.y===e}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}function u(t){t.split(",").length,isNaN(Number(t.split(",")[0])),isNaN(Number(t.split(",")[1]));const[e,n]=t.split(",");return new c(Number(e),Number(n))}const d=[new c(-40,-60),new c(40,-60),new c(80,0),new c(40,60),new c(-40,60),new c(-80,0)],h=[new c(0,-1),new c(1,-1),new c(-1,0),new c(0,0),new c(1,0),new c(-1,1),new c(0,1)];function l({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return!(o>60||n>80)&&(n<=40||(80-n)/80>=o/120)}const f={food:1/0,wood:1/0,stone:1/0,iron:1/0,gold:1/0};function m(t,e,[n,o,r]){t[e]=n,t[e+1]=o,t[e+2]=r,t[e+3]=255}function w(t,e){const n=document.createElement("canvas");n.width=t,n.height=e;const o=n.getContext("2d");return o.imageSmoothingEnabled=!1,[n,o]}const g=new Map;const y={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function x(t,e){return function(t,e){const n=String(t);return g.has(n)||g.set(n,e()),g.get(n)}(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(p)),9*e.length-3]}(t),[r,s]=w(n,o),a=s.createImageData(n,o);let i=0,c=0;for(const n of t)"\n"===n?(i+=9,c=0):(b(a,e,c,i,n),c+=1+v(y[n]));return s.putImageData(a,0,0),r})}function b(t,e,n,o,r){const s=y[r],a=v(s);for(let r=0;r<6*a;r+=1)if(s&1<<r){const s=n+r%a,i=o+Math.floor(r/a);m(t.data,4*(i*t.width+s),e)}}function p(t){return[...t].reduce((t,e)=>t+v(y[e]),1*Math.max(t.length-1,0))}function v(t){return(t.toString(2).length-1)/6}const H={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},M=new Map;function k(){M.clear(),function(t,e){C(e,t,!0);for(const t of h)C(e.add(t),"blank",!1)}("townCenter",new c(0,0))}function C(t,o,r){const s=t.toHash();if(M.has(s)){if(!r)return;a=M.get(s).drawableHandle,e.delete(a)}var a;M.set(s,{name:o,hex:t,drawableHandle:n(A({name:H[o].name,hex:t}))})}function q(t){const e=document.createElement("button");e.textContent="Build "+H[t].name,e.addEventListener("click",()=>{!function(t){const e=H[t],n=(o=e.requirements,o.filter(([t,e])=>e>f[t]).map(([t])=>"Not enough "+t));var o;if(n.length>0){const t=document.createElement("pre");t.textContent=n.join("\n"),document.body.append(t),s={frame:r(5e3),run:()=>{document.body.removeChild(t)}},i.push(new a(s))}else!function(t){for(const[e,n]of t)f[e]-=n}(e.requirements);var s}(t)}),document.body.append(e)}function A({name:t,hex:e}){return(n,o,r,s,a)=>{n.lineJoin="round",n.lineWidth=3,n.strokeStyle="black",n.fillStyle="hotpink";const i=e.toCanvas().add(o);n.beginPath();const[c,...u]=d;n.moveTo(...i.add(c).toArray());for(const t of u)n.lineTo(...i.add(t).toArray());n.closePath(),a&&e.equal(s)&&n.fill(),n.stroke();const h=x(`[${e.x}, ${e.y}]\n${t}`,[0,0,0]);n.drawImage(h,...i.addCoords(1.5*-h.width,1.5*-h.height).round().toArray(),3*h.width,3*h.height)}}const[N,S]=w(1e3,1e3),E=new c(500,500);let j=new c(0,0),F=new c(0,0),P=!1;function T(){document.body.append(N),N.addEventListener("mousemove",t=>{const{left:e,top:n,width:o,height:r}=N.getBoundingClientRect();j=new c((t.clientX-e)*(1e3/o),(t.clientY-n)*(1e3/r)),P=!0}),N.addEventListener("mouseout",()=>{P=!1})}function D(){S.clearRect(0,0,1e3,1e3),function(){const t=j.sub(E),e=t.toHex().round().toCanvas();for(const n of h){const o=e.add(n.toCanvas());l(t.sub(o))&&(F=o.toHex())}}();for(const t of e.values())t(S,E,j,F,P)}const I=[1,2],L=[3,5];const $={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold",water:"#D6EAF8"};function B({terrain:t,hex:e}){return(n,o)=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=$[t];const r=e.toCanvas().add(o);n.beginPath();const[s,...a]=d;n.moveTo(...r.add(s).toArray());for(const t of a)n.lineTo(...r.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}function J(){!function(){const t=[];for(const[e,n]of i.entries()){const r=o-n.frame;if(r>n.totalFrames)return void t.push(e);if(r<0)return;n.run(r,n.totalFrames)}for(const e of t.reverse())i.splice(e,1)}(),D()}let R=0;document.title="setlerio",function(){const t=new Map,e=new Set(h.map(t=>t.toHash()));function o(n,r,[s,a],i=!1,c=s+Math.random()*(a-s)){if((i||!e.has(r.toHash()))&&!(c<=0)){t.set(r.toHash(),n),o(n,r.add(h[Math.floor(Math.random()*h.length)]),[0,0],i,c-1);for(const t of h)e.add(r.add(t).toHash())}}for(let e=-38;e<=38;e+=1)for(let n=-38;n<=38;n+=1)t.set(new c(n,e).toHash(),"water");for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o("desert",new c(e,t),I,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const r=new c(n,e);if("water"!==t.get(r.toHash()))continue;const s=Math.random();s<.4?t.set(r.toHash(),"meadow"):s<.85?t.set(r.toHash(),"forest"):s<.95?o("mountains",r,L):o("desert",r,I),"water"===t.get(r.toHash())&&t.set(r.toHash(),"meadow")}t.set(new c(0,0).toHash(),"meadow");for(const[e,o]of t.entries())n(B({terrain:o,hex:u(e)}))}(),T(),k(),q("lumberjackHut"),q("tower"),function t(e){requestAnimationFrame(t),e>=R+49&&(R=e,o=r(),J())}(0);</script>
