<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%)}</style><body><script>"use strict";function t(t,e){t.beginPath();const[n,...o]=e;t.moveTo(...n.toArray());for(const e of o)t.lineTo(...e.toArray());t.closePath()}let e=0;const n=new Map;function o(...t){return e+=1,n.set(e,t),e}function r(t){n.delete(t)}function s(t,e,n=!1){const o=document.createElement("canvas");o.width=t,o.height=e;const r=o.getContext("2d");return r.imageSmoothingEnabled=n,[o,r]}class i{constructor(t,e){this.x=t,this.y=e}add({x:t,y:e}){return new i(this.x+t,this.y+e)}mul(t){return new i(this.x*t,this.y*t)}sub({x:t,y:e}){return new i(this.x-t,this.y-e)}toHex(){return new i(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new i(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new i(Math.round(this.x),Math.round(this.y))}equal(t){return Boolean(t&&this.x===t.x&&this.y===t.y)}distance({x:t,y:e}){return((this.x-t)**2+(this.y-e)**2)**.5}toArray(){return[this.x,this.y]}toHash(){return`${this.x},${this.y}`}}function a(t){const e=t.indexOf(",");return new i(Number(t.slice(0,e)),Number(t.slice(e+1)))}const c=[new i(-40,-60),new i(40,-60),new i(80,0),new i(40,60),new i(-40,60),new i(-80,0)];function u(t,e,n=0){return 0===e?[t]:[...f(e).map((n,o,r)=>new i(t.x+n,t.y+r[(o+2*e)%r.length])),...e>n?u(t,e-1,n):[]]}function f(t){return[...l(t),...l(t).map(t=>-t)]}function l(t){return 0===t?[]:[-t,1-t,...l(t-1).map(t=>t+1),t]}const d=u(new i(0,0),1);function h({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return o<=60&&(n<=40||80-n>=o*(80/120))}function m(t,e,[n,o,r]){t[e]=n,t[e+1]=o,t[e+2]=r,t[e+3]=255}const w=new Map;function y(t,e){const n=String(t);return w.has(n)||w.set(n,e()),w.get(n)}const v={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144,">":267537,"âˆž":1074091328};function x(t,e,n,o,r,i=0,a=0,c=3){const u=y([e,n,c],()=>{const t=function(t,e){return y(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(p)),9*e.length-3]}(t),[r,i]=s(n,o),a=i.createImageData(n,o);let c=0,u=0;for(const n of t)"\n"===n?(c+=9,u=0):(g(a,e,u,c,n),u+=1+H(v[n]));return i.putImageData(a,0,0),r})}(e,n),[o,r]=s(t.width*c,t.height*c);return r.drawImage(t,0,0,t.width*c,t.height*c),o});t.drawImage(u,o-u.width*i,r-u.height*a)}function g(t,e,n,o,r){const s=v[r],i=H(s);for(let r=0;r<6*i;r+=1)if(s&1<<r){const s=n+r%i,a=o+Math.floor(r/i);m(t.data,4*(a*t.width+s),e)}}function p(t){return[...t].reduce((t,e)=>t+H(v[e]),1*Math.max(t.length-1,0))}function H(t){return(t.toString(2).length-1)/6}let b=!1,M={left:0,top:0,height:0},S=-1,A=[],E=new i(0,0);function L(){b=!1,r(S)}function k(t,e=E){L(),b=!0,S=o(4,C);const n=48*t.length,r=32+n;M={left:16+Math.max(0,Math.min(712,e.x-144)),top:e.y+16-(e.y>728?r:0),height:n},A=t,E=e}function C(t){Y(()=>{t.fillStyle="white",t.fillRect(M.left,M.top,256,M.height);for(const[e,[n,o]]of A.entries())x(t,n,[0,0,0],M.left+16,M.top+48*(e+.5),0,.5),Array.isArray(o)&&x(t,">",[0,0,0],M.left+256-16,M.top+48*(e+.5),1,.5)})}function q({x:t,y:e},n){return t>=M.left&&t<M.left+256&&e>=M.top+48*n&&e<M.top+48*(n+1)}const[D,F]=s(1e3,1e3,!0);D.style.background="#D6EAF8";let R,T,$,j=new i(0,0),I=1,O=!1,J=!1;const P=new i(500,500);function W({clientX:t,clientY:e}){const{left:n,top:o,width:r,height:s}=D.getBoundingClientRect();return new i(1e3/r*(t-n),1e3/s*(e-o))}function z(t){const e=t.sub(P).mul(1/I).add(j),n={relative:t,canvas:e,hex:new i(0,0)},o=e.toHex().round().toCanvas();for(const t of d){const r=o.add(t.toCanvas());h(e.sub(r))&&(n.hex=r.toHex())}return n}function B(t,e){return t.sub(P).mul(1/I).sub(e).mul(-1)}function N(t,e){const{x:n,y:o}=t.sub(e).toCanvas();return Math.abs(n)<=1160&&Math.abs(o)<=1120}function Y(t){F.save(),F.resetTransform(),t(),F.restore()}let X=0;function G(t){return Math.round(.06*t)}class K{constructor({run:t,when:e=0,duration:n=0}){this.run=t,this.frame=X+1+G(e),this.totalFrames=G(n)}}let Q=0;const U=new Map;function V(t){return Q+=1,U.set(Q,new K(t)),Q}const Z=[new i(-60,-12),new i(60,-12),new i(60,12),new i(-60,12)],_={food:100,wood:100,stone:100,iron:100,gold:100},tt=new Set,et=new Set;let nt=!1;function ot(t){nt?et.add(t):(tt.add(t),nt=!0,V({run:rt(t),duration:200}),V({run:st(t),when:5200,duration:200}))}function rt(t){return(e,n)=>{if(t.offset=e/n-1,t.opacity=e/n,e===n&&(nt=!1,et.size>0)){const[t]=et;et.delete(t),ot(t)}}}function st(t){return(e,n)=>{t.offset=e/n/3,t.opacity=1-e/n,e===n&&tt.delete(t)}}const it=[{name:"",indestructible:!0},{name:"town center",indestructible:!0},{name:"tower",requirements:[[["wood",2],["stone",3]],5e3]},{name:"lumberjack's hut",requirements:[[["wood",2],["stone",2]],5e3],production:[[["wood",1]],5e3]}],at=new Map,ct=new Set,ut=new Set;function ft(t,e){ht(t,e,!0),dt(e)&&mt(t)}function lt(t){const{id:e}=at.get(t.toHash());ht(t,0,!0),dt(e)&&mt(t)}function dt(t){return 1===t||2===t}function ht(t,e,n){const r=t.toHash();if(at.has(r)){if(!n)return;wt(at.get(r))}at.set(r,{id:e,hex:t,drawableHandle:o(1,vt({name:gt(e),hex:t}),t)})}function mt(t){const e=new Set,n=new Set,o=0!==at.get(t.toHash()).id;for(const o of u(t,4)){const t=at.get(o.toHash());if(t&&dt(t.id)){for(const n of u(t.hex,2,2))e.add(n.toHash());for(const e of u(t.hex,1))n.add(e.toHash())}}if(o){for(const e of u(t,2))ht(e,0,!1);for(const e of u(t,2,2)){const t=e.toHash();n.has(t)||ut.add(t)}for(const e of u(t,1)){const t=e.toHash();ut.delete(t)}}else{for(const t of n)e.delete(t);for(const o of u(t,2)){const t=o.toHash();e.has(t)?ut.add(t):n.has(t)||(wt(at.get(t)),at.delete(t),ct.add(t),ut.delete(t))}}}function wt(t){r(t.drawableHandle),t.cancel&&t.cancel()}function yt(e,n){const{requirements:s}=it[n],i=function([t]){const e=t.filter(([t,e])=>e>_[t]).map(([t,e])=>`${e-_[t]} ${t}`);if(e.length>0)return"missing: "+e.join(", ")}(s);if(i)return void ot({text:i,offset:-1,opacity:0});const a=at.get(e.toHash()),[c,u]=function(e){const n={progress:0},s=o(2,function(e,n){return o=>{const r=e.toCanvas(),s=(100*n.progress).toFixed(0)+"%";t(o,Z.map(t=>t.add(r))),o.fillStyle="#fff3",o.lineWidth=3,o.lineJoin="miter",o.strokeStyle="white",o.fill(),o.stroke(),o.fillStyle="white",o.fillRect(...r.add({x:-60,y:-12}).toArray(),120*n.progress,24),x(o,s,[0,0,0],...r.toArray(),.5,.5)}}(e,n),e);return[t=>{n.progress=t},()=>{r(s)}]}(e),f=V({run:(t,o)=>{t===o?(u(),ft(e,n)):c(t/o)},duration:s[1]});a.cancel=()=>{u(),U.delete(f),a.cancel=void 0},function([t]){for(const[e,n]of t)_[e]-=n}(s)}function vt({name:e,hex:n}){return o=>{const r=n.toCanvas();var s,i;n.equal(null!=(s=$)?s:null==(i=R)?void 0:i.hex)&&(t(o,c.map(t=>t.add(r))),o.fillStyle="#fff9",o.fill()),e&&x(o,e,[0,0,0],...r.toArray(),.5,.5)}}let xt=0;function gt(t){return it[t].name}const pt=["springgreen","forestgreen","sienna","gold"],Ht=[1,2],bt=[3,5];function Mt({terrain:e,hex:n}){return o=>{const r=n.toCanvas();t(o,c.map(t=>t.add(r))),o.fillStyle=pt[e],o.lineJoin="round",o.lineWidth=.5,o.strokeStyle="black",o.fill(),o.stroke()}}let St=0;document.title="setlerio",o(3,(function(t){Y(()=>{let e=0;t.fillStyle="white";for(const n of[...tt].reverse()){e+=1+n.offset,t.globalAlpha=n.opacity;const o=1e3-88*e;t.fillRect(528,o,448,64),x(t,n.text,[0,0,0],552,o+32,0,.5)}})})),o(3,(function(t){Y(()=>{t.fillStyle="white",t.fillRect(0,0,1e3,48),x(t,Object.entries(_).map(([t,e])=>`${t}: ${String(e).padStart(4," ")}`).join("   "),[0,0,0],24,24,0,.5)})})),function(){const t=new Map,e=new Set(d.map(t=>t.toHash()));function n(o,r,[s,i],a=!1,c=s+Math.random()*(i-s)){if((a||!e.has(r.toHash()))&&!(c<=0)){t.set(r.toHash(),o),n(o,r.add(d[Math.floor(Math.random()*d.length)]),[0,0],a,c-1);for(const t of d)e.add(r.add(t).toHash())}}for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const o=(e**2+t**2)**.5;o<28&&o>26.5&&n(3,new i(e,t),Ht,!0)}for(let e=-28;e<=28;e+=1)for(let o=-28;o<=28;o+=1)if((o**2+e**2)**.5<28){const r=new i(o,e);if(!t.has(r.toHash())){const e=Math.random();e<.4?t.set(r.toHash(),0):e<.85?t.set(r.toHash(),1):e<.95?n(2,r,bt):n(3,r,Ht)}t.has(r.toHash())||t.set(r.toHash(),0)}t.set(new i(0,0).toHash(),0);for(const[e,n]of t.entries()){const t=a(e);o(0,Mt({terrain:n,hex:t}),t)}}(),document.body.append(D),D.addEventListener("mousemove",t=>{R=z(W(t))}),document.addEventListener("mousemove",t=>{T&&(R=z(W(t)),!O&&T.relative.distance(R.relative)>5&&(O=!0),O&&(j=B(R.relative,T.canvas),R=z(W(t))))}),D.addEventListener("contextmenu",t=>{t.preventDefault()}),D.addEventListener("wheel",({deltaY:t})=>{$&&(L(),$=void 0),R&&(I=Math.max(.5,Math.min(1,I-.0625*Math.sign(t))),j=B(R.relative,R.canvas))}),D.addEventListener("mouseout",()=>{O||(R=void 0)}),D.addEventListener("mousedown",t=>{if(t.preventDefault(),R=z(W(t)),$){if(function(t){for(const[e,[,n]]of A.entries())if(q(t,e))return Array.isArray(n)?k(n):(L(),n()),!0;return L(),!1}(R.relative))return J=!0,void(b||($=void 0));$.equal(R.hex)&&(J=!0),$=void 0}T=R}),D.addEventListener("mouseup",t=>{if(R=z(W(t)),!O&&!J&&T&&T.hex.equal(R.hex)){const t=function(t){const e=t.toHash();if(!at.has(e))return;const n=at.get(e);return n.cancel?[["cancel",()=>function(t){at.get(t.toHash()).cancel()}(t)]]:0===n.id?[["build",[[gt(3),()=>yt(t,3)],[gt(2),()=>yt(t,2)]]]]:it[n.id].indestructible?void 0:[["destroy",()=>function(t){lt(t)}(t)]]}(T.hex);t&&($=T.hex,k(t,T.relative))}}),document.addEventListener("mouseup",()=>{R&&(R.relative.x<0||R.relative.y<0||R.relative.x>1e3||R.relative.y>1e3)&&(R=void 0),T=void 0,O=!1,J=!1}),document.addEventListener("visibilitychange",()=>{R=void 0,T=void 0,O=!1,J=!1}),o(2,(function(t){t.beginPath();for(const e of ut){const n=a(e),o=n.toCanvas();for(let e=0;e<6;e+=1)at.has(n.add(d[e]).toHash())||(t.moveTo(...o.add(c[e]).toArray()),t.lineTo(...o.add(c[(e+1)%6]).toArray()))}t.lineJoin="round",t.lineWidth=4,t.strokeStyle="white",t.lineDashOffset=xt,t.setLineDash([6,4]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])})),V({run:function(t){xt=.20833333333333331*t%10},duration:1/0}),ft(new i(0,0),1),ft(new i(2,-2),2),ft(new i(3,-1),2),lt(new i(2,-2)),function t(e){requestAnimationFrame(t),e>=St+15.666666666666668&&(St=e,X+=1,function(){for(const[t,e]of U.entries()){const n=X-e.frame;n>e.totalFrames?U.delete(t):n>=0&&e.run(n,e.totalFrames)}}(),function(){F.resetTransform(),F.clearRect(0,0,1e3,1e3),F.translate(500,500),F.scale(I,I),F.translate(-j.x,-j.y);const t=[[],[],[],[],[]],e=j.toHex();for(const[o,r,s]of n.values())s&&!N(s,e)||t[o].push(r);for(const e of t)for(const t of e)t(F)}())}(0);</script>
