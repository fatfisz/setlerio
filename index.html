<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const e=new Map;function n(n){return t+=1,e.set(t,n),t}let o=0;function r(t=0){return o+1+a(t)}function a(t){return Math.round(.02*t)}class s{constructor({frame:t,duration:e=0,run:n}){this.frame=t,this.totalFrames=a(e),this.run=n}}const i=[];class u{constructor(t,e){this.x=t,this.y=e}add(t){return new u(this.x+t.x,this.y+t.y)}addCoords(t,e){return new u(this.x+t,this.y+e)}sub(t){return new u(this.x-t.x,this.y-t.y)}toHex(){return new u(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new u(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new u(Math.round(this.x),Math.round(this.y))}equal({x:t,y:e}){return this.x===t&&this.y===e}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}function c(t){t.split(",").length,isNaN(Number(t.split(",")[0])),isNaN(Number(t.split(",")[1]));const[e,n]=t.split(",");return new u(Number(e),Number(n))}const d=[new u(-40,-60),new u(40,-60),new u(80,0),new u(40,60),new u(-40,60),new u(-80,0)],h=[new u(0,-1),new u(1,-1),new u(-1,0),new u(0,0),new u(1,0),new u(-1,1),new u(0,1)];const l={food:1/0,wood:1/0,stone:1/0,iron:1/0,gold:1/0};function f(t,e,[n,o,r]){t[e]=n,t[e+1]=o,t[e+2]=r,t[e+3]=255}function m(t,e){const n=document.createElement("canvas");n.width=t,n.height=e;const o=n.getContext("2d");return o.imageSmoothingEnabled=!1,[n,o]}const w=new Map;const g={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function y(t,e){return function(t,e){const n=String(t);return w.has(n)||w.set(n,e()),w.get(n)}(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(b)),9*e.length-3]}(t),[r,a]=m(n,o),s=a.createImageData(n,o);let i=0,u=0;for(const n of t)"\n"===n?(i+=9,u=0):(x(s,e,u,i,n),u+=1+p(g[n]));return a.putImageData(s,0,0),r})}function x(t,e,n,o,r){const a=g[r],s=p(a);for(let r=0;r<6*s;r+=1)if(a&1<<r){const a=n+r%s,i=o+Math.floor(r/s);f(t.data,4*(i*t.width+a),e)}}function b(t){return[...t].reduce((t,e)=>t+p(g[e]),1*Math.max(t.length-1,0))}function p(t){return(t.toString(2).length-1)/6}const H={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},v=new Map;function C(){var t,e;v.clear(),t="townCenter",M(e=new u(0,0),t,!0),h.forEach(t=>{M(e.add(t),"blank",!1)})}function M(t,o,r){const a=t.toHash();if(v.has(a)){if(!r)return;s=v.get(a).drawableHandle,e.delete(s)}var s;v.set(a,{name:o,hex:t,drawableHandle:n(E({name:H[o].name,hex:t}))})}function k(t){const e=document.createElement("button");e.textContent="Build "+H[t].name,e.addEventListener("click",()=>{!function(t){const e=H[t],n=(o=e.requirements,o.filter(([t,e])=>e>l[t]).map(([t])=>"Not enough "+t));var o;if(n.length>0){const t=document.createElement("pre");t.textContent=n.join("\n"),document.body.append(t),a={frame:r(5e3),run:()=>{document.body.removeChild(t)}},i.push(new s(a))}else!function(t){t.forEach(([t,e])=>{l[t]-=e})}(e.requirements);var a}(t)}),document.body.append(e)}function E({name:t,hex:e}){return(n,o,r,a,s)=>{n.lineJoin="round",n.lineWidth=3,n.strokeStyle="black",n.fillStyle="hotpink";const i=e.toCanvas().add(o);n.beginPath();const[u,...c]=d;n.moveTo(...i.add(u).round().toArray());for(const t of c)n.lineTo(...i.add(t).round().toArray());n.closePath(),s&&e.equal(a)&&n.fill(),n.stroke();const h=y(`[${e.x}, ${e.y}]\n${t}`,[0,0,0]);n.drawImage(h,...i.addCoords(1.5*-h.width,1.5*-h.height).round().toArray(),3*h.width,3*h.height)}}const[q,A]=m(1e3,1e3),N=new u(500,500);let S=new u(0,0),j=new u(0,0),F=!1;function P(){document.body.append(q),q.addEventListener("mousemove",t=>{const{left:e,top:n,width:o,height:r}=q.getBoundingClientRect();S=new u((t.clientX-e)*(1e3/o),(t.clientY-n)*(1e3/r)),F=!0}),q.addEventListener("mouseout",()=>{F=!1})}function T(){A.clearRect(0,0,1e3,1e3),function(){const t=S.sub(N),e=t.toHex().round().toCanvas();h.forEach(n=>{const o=e.add(n.toCanvas());(function({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return!(o>60||n>80)&&(n<=40||(80-n)/80>=o/120)})(t.sub(o))&&(j=o.toHex().round())})}();for(const t of e.values())t(A,N,S,j,F)}const D={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold",water:"#D6EAF8"};function I({terrain:t,hex:e}){return(n,o)=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=D[t];const r=e.toCanvas().add(o);n.beginPath();const[a,...s]=d;n.moveTo(...r.add(a).round().toArray());for(const t of s)n.lineTo(...r.add(t).round().toArray());n.closePath(),n.fill(),n.stroke()}}function L(){!function(){const t=[];i.forEach((e,n)=>{const r=o-e.frame;r>e.totalFrames?t.push(n):r<0||e.run(r,e.totalFrames)}),t.reverse().forEach(t=>{i.splice(t,1)})}(),T()}let $=0;document.title="setlerio",function(){const t=new Map,e=new Set(h.map(t=>t.toHash()));function o(n,r=3+2*Math.random()){if(e.has(n.toHash()))return;if(r<=0)return;t.set(n.toHash(),"mountains");const a=Math.random();o(a<.4?n.addCoords(1,0):a<.8?n.addCoords(0,1):n.addCoords(-1,1),r-1);for(const t of h)e.add(n.add(t).toHash())}function r(n){if(e.has(n.toHash()))return;const o=[n,n.add(h[Math.floor(Math.random()*h.length)])];for(const n of o){t.set(n.toHash(),"desert");for(const t of h)e.add(n.add(t).toHash())}}for(let e=-38;e<=38;e+=1)for(let n=-38;n<=38;n+=1)t.set(new u(n,e).toHash(),"water");for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&r(new u(e,t))}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const a=new u(n,e);if("water"!==t.get(a.toHash()))continue;const s=Math.random();s<.4?t.set(a.toHash(),"meadow"):s<.85?t.set(a.toHash(),"forest"):s<.95?o(a):r(a),"water"===t.get(a.toHash())&&t.set(a.toHash(),"meadow")}t.set(new u(0,0).toHash(),"meadow");for(const[e,o]of t.entries())n(I({terrain:o,hex:c(e)}))}(),P(),C(),k("lumberjackHut"),k("tower"),function t(e){requestAnimationFrame(t),e>=$+49&&($=e,o=r(),L())}(0);</script>
