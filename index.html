<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const e=new Map;function n(n){return t+=1,e.set(t,n),t}let o=0;function r(t=0){return o+1+a(t)}function a(t){return Math.round(.02*t)}class s{constructor({frame:t,duration:e=0,run:n}){this.frame=t,this.totalFrames=a(e),this.run=n}}const i=[];class c{constructor(t,e){this.x=t,this.y=e}add(t){return new c(this.x+t.x,this.y+t.y)}addCoords(t,e){return new c(this.x+t,this.y+e)}sub(t){return new c(this.x-t.x,this.y-t.y)}toHex(){return new c(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new c(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new c(Math.round(this.x),Math.round(this.y))}equal({x:t,y:e}){return this.x===t&&this.y===e}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}function u(t){t.split(",").length,isNaN(Number(t.split(",")[0])),isNaN(Number(t.split(",")[1]));const[e,n]=t.split(",");return new c(Number(e),Number(n))}const d=[new c(-40,-60),new c(40,-60),new c(80,0),new c(40,60),new c(-40,60),new c(-80,0)],h=[new c(0,-1),new c(1,-1),new c(-1,0),new c(0,0),new c(1,0),new c(-1,1),new c(0,1)];const l={food:1/0,wood:1/0,stone:1/0,iron:1/0,gold:1/0};function f(t,e,[n,o,r]){t[e]=n,t[e+1]=o,t[e+2]=r,t[e+3]=255}function m(t,e){const n=document.createElement("canvas");n.width=t,n.height=e;const o=n.getContext("2d");return o.imageSmoothingEnabled=!1,[n,o]}const w=new Map;const g={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function y(t,e){return function(t,e){const n=String(t);return w.has(n)||w.set(n,e()),w.get(n)}(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(b)),9*e.length-3]}(t),[r,a]=m(n,o),s=a.createImageData(n,o);let i=0,c=0;for(const n of t)"\n"===n?(i+=9,c=0):(x(s,e,c,i,n),c+=1+p(g[n]));return a.putImageData(s,0,0),r})}function x(t,e,n,o,r){const a=g[r],s=p(a);for(let r=0;r<6*s;r+=1)if(a&1<<r){const a=n+r%s,i=o+Math.floor(r/s);f(t.data,4*(i*t.width+a),e)}}function b(t){return[...t].reduce((t,e)=>t+p(g[e]),1*Math.max(t.length-1,0))}function p(t){return(t.toString(2).length-1)/6}const v={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},H=new Map;function M(){var t,e;H.clear(),t="townCenter",k(e=new c(0,0),t,!0),h.forEach(t=>{k(e.add(t),"blank",!1)})}function k(t,o,r){const a=t.toHash();if(H.has(a)){if(!r)return;s=H.get(a).drawableHandle,e.delete(s)}var s;H.set(a,{name:o,hex:t,drawableHandle:n(E({name:v[o].name,hex:t}))})}function C(t){const e=document.createElement("button");e.textContent="Build "+v[t].name,e.addEventListener("click",()=>{!function(t){const e=v[t],n=(o=e.requirements,o.filter(([t,e])=>e>l[t]).map(([t])=>"Not enough "+t));var o;if(n.length>0){const t=document.createElement("pre");t.textContent=n.join("\n"),document.body.append(t),a={frame:r(5e3),run:()=>{document.body.removeChild(t)}},i.push(new s(a))}else!function(t){t.forEach(([t,e])=>{l[t]-=e})}(e.requirements);var a}(t)}),document.body.append(e)}function E({name:t,hex:e}){return(n,o,r,a,s)=>{n.lineJoin="round",n.lineWidth=3,n.strokeStyle="black",n.fillStyle="hotpink";const i=e.toCanvas().add(o);n.beginPath();const[c,...u]=d;n.moveTo(...i.add(c).toArray());for(const t of u)n.lineTo(...i.add(t).toArray());n.closePath(),s&&e.equal(a)&&n.fill(),n.stroke();const h=y(`[${e.x}, ${e.y}]\n${t}`,[0,0,0]);n.drawImage(h,...i.addCoords(1.5*-h.width,1.5*-h.height).round().toArray(),3*h.width,3*h.height)}}const[q,A]=m(1e3,1e3),N=new c(500,500);let S=new c(0,0),j=new c(0,0),F=!1;function P(){document.body.append(q),q.addEventListener("mousemove",t=>{const{left:e,top:n,width:o,height:r}=q.getBoundingClientRect();S=new c((t.clientX-e)*(1e3/o),(t.clientY-n)*(1e3/r)),F=!0}),q.addEventListener("mouseout",()=>{F=!1})}function T(){A.clearRect(0,0,1e3,1e3),function(){const t=S.sub(N),e=t.toHex().round().toCanvas();h.forEach(n=>{const o=e.add(n.toCanvas());(function({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return!(o>60||n>80)&&(n<=40||(80-n)/80>=o/120)})(t.sub(o))&&(j=o.toHex())})}();for(const t of e.values())t(A,N,S,j,F)}const D=[1,2],I=[3,5];const L={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold",water:"#D6EAF8"};function $({terrain:t,hex:e}){return(n,o)=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=L[t];const r=e.toCanvas().add(o);n.beginPath();const[a,...s]=d;n.moveTo(...r.add(a).toArray());for(const t of s)n.lineTo(...r.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}function B(){!function(){const t=[];i.forEach((e,n)=>{const r=o-e.frame;r>e.totalFrames?t.push(n):r<0||e.run(r,e.totalFrames)}),t.reverse().forEach(t=>{i.splice(t,1)})}(),T()}let J=0;document.title="setlerio",function(){const t=new Map,e=new Set(h.map(t=>t.toHash()));function o(n,r,[a,s],i=!1,c=a+Math.random()*(s-a)){if((i||!e.has(r.toHash()))&&!(c<=0)){t.set(r.toHash(),n),o(n,r.add(h[Math.floor(Math.random()*h.length)]),[0,0],i,c-1);for(const t of h)e.add(r.add(t).toHash())}}for(let e=-38;e<=38;e+=1)for(let n=-38;n<=38;n+=1)t.set(new c(n,e).toHash(),"water");for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o("desert",new c(e,t),D,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const r=new c(n,e);if("water"!==t.get(r.toHash()))continue;const a=Math.random();a<.4?t.set(r.toHash(),"meadow"):a<.85?t.set(r.toHash(),"forest"):a<.95?o("mountains",r,I):o("desert",r,D),"water"===t.get(r.toHash())&&t.set(r.toHash(),"meadow")}t.set(new c(0,0).toHash(),"meadow");for(const[e,o]of t.entries())n($({terrain:o,hex:u(e)}))}(),P(),M(),C("lumberjackHut"),C("tower"),function t(e){requestAnimationFrame(t),e>=J+49&&(J=e,o=r(),B())}(0);</script>
