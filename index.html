<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><body><script>"use strict";let t=0;const e=new Map;function n(...n){return t+=1,e.set(t,n),t}function o(t){e.delete(t)}let s=0;function r(t=0){return s+1+a(t)}function a(t){return Math.round(.06*t)}class i{constructor({frame:t=s+1,duration:e=0,run:n}){this.frame=t,this.totalFrames=a(e),this.run=n}}const u=[];function d(t){u.push(new i(t))}class c{constructor(t,e){this.x=t,this.y=e}add({x:t,y:e}){return new c(this.x+t,this.y+e)}mul(t){return new c(this.x*t,this.y*t)}sub({x:t,y:e}){return new c(this.x-t,this.y-e)}toHex(){return new c(this.x/240+this.y/120,this.x/240-this.y/120)}toCanvas(){return new c(240*(this.x+this.y)/2,120*(this.x-this.y)/2)}round(){return new c(Math.round(this.x),Math.round(this.y))}equal({x:t,y:e}){return this.x===t&&this.y===e}distance({x:t,y:e}){return((this.x-t)**2+(this.y-e)**2)**.5}toArray(){return[this.x,this.y]}toHash(){return String(this.toArray())}}function h(t){t.split(",").length,isNaN(Number(t.split(",")[0])),isNaN(Number(t.split(",")[1]));const[e,n]=t.split(",");return new c(Number(e),Number(n))}const l=[new c(-40,-60),new c(40,-60),new c(80,0),new c(40,60),new c(-40,60),new c(-80,0)],f=[new c(-1,1),new c(0,1),new c(1,0),new c(1,-1),new c(0,-1),new c(-1,0),new c(0,0)];function m({x:t,y:e}){const n=Math.abs(t),o=Math.abs(e);return o<=60&&(n<=40||80-n>=o*(80/120))}const w={food:1/0,wood:1/0,stone:1/0,iron:1/0,gold:1/0};function v(t,e,[n,o,s]){t[e]=n,t[e+1]=o,t[e+2]=s,t[e+3]=255}function y(t,e){const n=document.createElement("canvas");n.width=t,n.height=e;const o=n.getContext("2d");return o.imageSmoothingEnabled=!1,[n,o]}const x=new Map;const b={0:273258,1:271514,2:291491,3:276643,4:282441,5:276687,6:273098,7:271655,8:273066,9:272810,a:285679,b:277227,c:291407,d:277355,e:291535,f:266959,g:293711,h:285677,i:95,j:289575,k:285421,l:291401,m:1092147057,n:17407417,o:293743,p:267247,q:424815,r:284655,s:293327,t:271511,u:293741,v:273261,w:1106957873,x:285357,y:271853,z:291495," ":4096,".":80,",":112,"'":67,"!":87,":":74,"?":270503,"%":283301,"[":4951,"]":5035,"-":4144};function g(t,e){return function(t,e){const n=String(t);return x.has(n)||x.set(n,e()),x.get(n)}(["text",t,e],()=>{const[n,o]=function(t){const e=t.split("\n");return[Math.max(...e.map(H)),9*e.length-3]}(t),[s,r]=y(n,o),a=r.createImageData(n,o);let i=0,u=0;for(const n of t)"\n"===n?(i+=9,u=0):(p(a,e,u,i,n),u+=1+M(b[n]));return r.putImageData(a,0,0),s})}function p(t,e,n,o,s){const r=b[s],a=M(r);for(let s=0;s<6*a;s+=1)if(r&1<<s){const r=n+s%a,i=o+Math.floor(s/a);v(t.data,4*(i*t.width+r),e)}}function H(t){return[...t].reduce((t,e)=>t+M(b[e]),1*Math.max(t.length-1,0))}function M(t){return(t.toString(2).length-1)/6}const k={blank:{name:"-",requirements:[]},townCenter:{name:"town center",requirements:[]},lumberjackHut:{name:"lumberjack's hut",requirements:[["wood",2],["stone",2]]},tower:{name:"tower",requirements:[["wood",2],["stone",3]]}},C=new Map,E=new Set,S=new Set;let L=!1;function q(t,e){A(e,t,!0),function(){const t=new Set;S.clear();for(const e of C.values())if("townCenter"===e.name||"tower"===e.name)for(const n of f)for(const o of f)t.add(e.hex.add(n).add(o).toHash());for(const e of t){const n=h(e);A(n,"blank",!1);for(const e of f)if(!t.has(n.add(e).toHash())){S.add(n);break}}for(const[e,n]of C)t.has(e)||(o(n.drawableHandle),C.delete(e),E.add(e))}()}function A(t,e,s){const r=t.toHash();if(C.has(r)){if(!s)return;o(C.get(r).drawableHandle)}C.set(r,{name:e,hex:t,drawableHandle:n(D({name:k[e].name,hex:t}),t)})}function N(t){const e=document.createElement("button");e.textContent="Build "+k[t].name,e.addEventListener("click",()=>{!function(t){const e=k[t],n=(o=e.requirements,o.filter(([t,e])=>e>w[t]).map(([t])=>"Not enough "+t));var o;if(n.length>0){const t=document.createElement("pre");t.textContent=n.join("\n"),document.body.append(t),d({frame:r(5e3),run:()=>{document.body.removeChild(t)}})}else!function(t){for(const[e,n]of t)w[e]-=n}(e.requirements)}(t)}),document.body.append(e)}function D({name:t,hex:e}){return(n,o)=>{n.lineJoin="round",n.lineWidth=3,n.strokeStyle="black",n.fillStyle="#fffa";const s=e.toCanvas();n.beginPath();const[r,...a]=l;n.moveTo(...s.add(r).toArray());for(const t of a)n.lineTo(...s.add(t).toArray());n.closePath(),o&&e.equal(o)&&n.fill();const i=g(t,[0,0,0]);n.drawImage(i,...s.add(new c(i.width,i.height).mul(-1.5)).round().toArray(),3*i.width,3*i.height)}}let T=0;function j(t){t.beginPath();for(const e of S){const n=e.toCanvas();for(let o=0;o<6;o+=1)C.has(e.add(f[o]).toHash())||(t.moveTo(...n.add(l[o]).toArray()),t.lineTo(...n.add(l[(o+1)%6]).toArray()))}t.lineJoin="round",t.lineWidth=4,t.strokeStyle="white",t.lineDashOffset=T,t.setLineDash([6,4]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])}function F(t){T=.20833333333333331*t%10}const[P,I]=y(1e3,1e3);P.style.background="#D6EAF8";let J,W,B,O,R,Y,z,X=new c(0,0),G=1;const K=new c(500,500);function Q(){document.body.append(P),P.addEventListener("mousemove",t=>{J=U(t),V()}),document.addEventListener("mousemove",t=>{R&&(J=U(t),!z&&O.distance(J)>5&&(z=!0),z&&(X=Z(R)),V())}),P.addEventListener("contextmenu",t=>{t.preventDefault()}),P.addEventListener("wheel",({deltaY:t})=>{W&&(G=Math.max(.5,Math.min(1,G-.0625*Math.sign(t))),X=Z(W))}),P.addEventListener("mouseout",()=>{z||(J=void 0,W=void 0,B=void 0)}),P.addEventListener("mousedown",()=>{O=J,R=W,Y=B}),P.addEventListener("mouseup",()=>{!z&&Y&&B&&Y.equal(B)&&console.log("clicked!")}),document.addEventListener("mouseup",()=>{J&&(J.x<0||J.y<0||J.x>1e3||J.y>1e3)&&(J=void 0,W=void 0,B=void 0),O=void 0,R=void 0,Y=void 0,z=!1}),document.addEventListener("visibilitychange",()=>{J=void 0,W=void 0,B=void 0,O=void 0,R=void 0,Y=void 0,z=!1})}function U({clientX:t,clientY:e}){const{left:n,top:o,width:s,height:r}=P.getBoundingClientRect();return new c(1e3/s*(t-n),1e3/r*(e-o))}function V(){W=J.sub(K).mul(1/G).add(X);const t=W.toHex().round().toCanvas();for(const e of f){const n=t.add(e.toCanvas());m(W.sub(n))&&(B=n.toHex())}}function Z(t){return J.sub(K).mul(1/G).sub(t).mul(-1)}function $(){I.resetTransform(),I.clearRect(0,0,1e3,1e3),I.translate(500,500),I.scale(G,G),I.translate(-X.x,-X.y);const t=X.toHex();for(const[n,o]of e.values())o&&!_(o,t)||n(I,B)}function _(t,e){const{x:n,y:o}=t.sub(e).toCanvas();return Math.abs(n)<=1160&&Math.abs(o)<=1120}const tt=[1,2],et=[3,5];const nt={meadow:"springgreen",forest:"forestgreen",mountains:"sienna",desert:"gold"};function ot({terrain:t,hex:e}){return n=>{n.lineJoin="round",n.lineWidth=.5,n.strokeStyle="black",n.fillStyle=nt[t];const o=e.toCanvas();n.beginPath();const[s,...r]=l;n.moveTo(...o.add(s).toArray());for(const t of r)n.lineTo(...o.add(t).toArray());n.closePath(),n.fill(),n.stroke()}}function st(){!function(){const t=[];for(const[e,n]of u.entries()){const o=s-n.frame;if(o>n.totalFrames)return void t.push(e);if(o<0)return;n.run(o,n.totalFrames)}for(const e of t.reverse())u.splice(e,1)}(),$()}let rt=0;document.title="setlerio",function(){const t=new Map,e=new Set(f.map(t=>t.toHash()));function o(n,s,[r,a],i=!1,u=r+Math.random()*(a-r)){if((i||!e.has(s.toHash()))&&!(u<=0)){t.set(s.toHash(),n),o(n,s.add(f[Math.floor(Math.random()*f.length)]),[0,0],i,u-1);for(const t of f)e.add(s.add(t).toHash())}}for(let t=-28;t<=28;t+=1)for(let e=-28;e<=28;e+=1){const n=(e**2+t**2)**.5;n<28&&n>26.5&&o("desert",new c(e,t),tt,!0)}for(let e=-28;e<=28;e+=1)for(let n=-28;n<=28;n+=1)if((n**2+e**2)**.5<28){const s=new c(n,e);if(t.has(s.toHash()))continue;const r=Math.random();r<.4?t.set(s.toHash(),"meadow"):r<.85?t.set(s.toHash(),"forest"):r<.95?o("mountains",s,et):o("desert",s,tt),t.has(s.toHash())||t.set(s.toHash(),"meadow")}t.set(new c(0,0).toHash(),"meadow");for(const[e,o]of t.entries()){const t=h(e);n(ot({terrain:o,hex:t}),t)}}(),Q(),L||(n(j),d({run:F,duration:1/0}),L=!0),C.clear(),q("townCenter",new c(0,0)),q("tower",new c(2,-2)),q("tower",new c(3,-1)),N("lumberjackHut"),N("tower"),function t(e){requestAnimationFrame(t),e>=rt+15.666666666666668&&(rt=e,s=r(),st())}(0);</script>
